<!-- templates/index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WardWise</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@mui/material@latest/umd/material-ui.production.min.css">
    <link rel="stylesheet" href="/app/static/index.css">
</head>
<body>
    <header>
        <h1 class="title">WardWise</h1>
    </header>
    <main class="content">
        <section>
            <h2>Hospitals</h2>
            
            <ul class="c-list c-hospital-list">
                <li class="c-list-item">
                    <strong>Hospital ID:</strong> 001 <br>
                    <strong>Hospital Name:</strong> General Hospital <br>
                    <strong>User email:</strong> user@example.com <br>
                    <strong>Blood add-on email:</strong> blood_support@hospital.com <br>
                    <strong>Outpatient clinic booking email:</strong> outpatient_bookings@hospital.com <br>
                    <strong>Gastroenterology email:</strong> gastro@hospital.com <br>
                    <strong>Respiratory email:</strong> respiratory@hospital.com <br>
                    <strong>Microbiology email:</strong> microbiology@hospital.com
                </li>
            </ul>
        </section>

        <section>
            <h2>Users</h2>
            
            <ul class="c-list c-user-list">
                <li class="c-list-item">
                    <strong>User ID:</strong> U001 <br>
                    <strong>Name:</strong> Dr. Alice Smith <br>
                    <strong>Role:</strong> Doctor <br>
                    <strong>Email:</strong> alice.smith@hospital.com
                </li>
                <li class="c-list-item">
                    <strong>User ID:</strong> U002 <br>
                    <strong>Name:</strong> Dr. Bob Johnson <br>
                    <strong>Role:</strong> Doctor <br>
                    <strong>Email:</strong> bob.johnson@hospital.com
                </li>
                <li class="c-list-item">
                    <strong>User ID:</strong> U003 <br>
                    <strong>Name:</strong> Carol Davis <br>
                    <strong>Role:</strong> Admin Staff <br>
                    <strong>Email:</strong> carol.davis@hospital.com
                </li>
            </ul>
        </section>

        <section>
            <h2>Patients</h2>
            
            <ul class="c-list c-patient-list">
                <li class="c-list-item">
                    <strong>Patient ID:</strong> P001 <br>
                    <strong>Name:</strong> John Doe <br>
                    <strong>Age:</strong> 45 <br>
                    <strong>Condition:</strong> Hypertension <br>
                    <strong>Doctor:</strong> Dr. Smith
                </li>
                <li class="c-list-item">
                    <strong>Patient ID:</strong> P002 <br>
                    <strong>Name:</strong> Jane Doe <br>
                    <strong>Age:</strong> 37 <br>
                    <strong>Condition:</strong> Diabetes <br>
                    <strong>Doctor:</strong> Dr. Johnson
                </li>
            </ul>
        </section>

        <section>
            <h2>Task List</h2>
            
            <ul class="c-list">
                {% for task in tasks %}
                <li class="c-list-item">
                    <strong>{{ task.description }}</strong> <br>
                    <strong>Task Id:</strong> {{ task.task_id }}</br>
                    <strong>Task Type:</strong> {{ task.task_type }}<br>
                    {% if task.task_type != 'Unknown' %}
                    <button class="mui-button" onclick="automateTask('{{ task.task_id }}')">Automate Task</button>
                    {% endif %}
                </li>
                {% endfor %}
            </ul>
        </section>

        <section>
            <h2>Task Manager</h2>
            
            <form id="task-form" class="form">
                <div class="form-group">
                    <label for="task_description">Task:</label>
                    <input type="text" id="task_description" name="description" class="c-input" required>
                </div>

                <button type="submit" class="mui-button">Add Task</button>
            </form>
        </section>
    </main>

    <script>
        document.getElementById('task-form').addEventListener('submit', async function(event) {
            event.preventDefault(); // Prevent the default form submission

            const taskDescription = document.getElementById('task_description').value;

            try {
                const response = await fetch('http://localhost:8000/api/v1/tasks', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ description: taskDescription }),
                });

                if (response.ok) {
                    // Optionally refresh the page to reflect changes
                    location.reload();
                } else {
                    alert('Error adding task.');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('An unexpected error occurred.');
            }
        });

        async function automateTask(taskId) {
            try {
                const response = await fetch(`http://localhost:8000/api/v1/tasks/${taskId}/automate`, {
                    method: 'POST',
                });

                if (response.ok) {
                    alert('Task automated successfully.');
                    // Optionally refresh the task list or update UI
                } else {
                    alert('Error automating task.');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('An unexpected error occurred.');
            }
        }
    </script>
</body>
</html>
